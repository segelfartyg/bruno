<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Would use latest version, you'd better specify a version -->
    <script src="https://unpkg.com/naive-ui"></script>

    <title>Bruno</title>
    <style>
      .error > .status {
        color: red;
      }
      .success > .status {
        color: green;
      }

      .n-collapse-item.success > .n-collapse-item__header {
        background-color: rgba(237, 247, 242, 1);
      }
      .n-collapse-item.error > .n-collapse-item__header {
        background-color: rgba(251, 238, 241, 1);
      }

      .min-width-150 {
        min-width: 150px;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <n-config-provider :theme="theme">
        <n-layout embedded position="absolute" content-style="padding: 24px;">
          <n-card>
            <n-flex>
              <n-page-header title="Bruno run dashboard">
                <template #avatar>
                  <n-avatar size="large" style="background-color: transparent">
                    <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width={width} viewBox="0 0 128.000000 128.000000"
 preserveAspectRatio="xMidYMid meet">
<g transform="translate(0.000000,128.000000) scale(0.100000,-0.100000)"
fill="#000000" stroke="none">
<path d="M525 1214 c-22 -6 -153 -62 -223 -97 -86 -41 -190 -192 -252 -364
-42 -118 -17 -234 86 -389 47 -71 73 -89 107 -73 14 6 29 20 34 31 8 19 12 16
48 -31 42 -55 100 -101 128 -101 28 0 20 38 -10 54 -34 18 -84 69 -111 115
-16 26 -18 40 -11 58 6 16 4 53 -6 110 -16 93 -19 155 -8 218 l6 40 12 -35
c11 -32 15 -35 55 -38 24 -2 63 4 87 13 53 21 139 87 148 115 10 32 34 24 77
-25 48 -55 106 -90 172 -105 41 -9 53 -8 74 6 l25 16 -8 -108 c-4 -60 -8 -140
-9 -179 -1 -54 -6 -79 -24 -107 -24 -39 -96 -108 -112 -108 -11 0 -14 -33 -4
-43 15 -14 90 41 130 95 36 50 44 55 55 42 19 -24 48 -36 69 -29 23 7 101 121
134 197 58 130 56 185 -11 353 -58 146 -150 253 -237 276 -23 6 -79 29 -125
52 -78 39 -89 42 -180 44 -53 1 -105 -1 -116 -3z m265 -77 c30 -14 66 -32 80
-40 14 -9 44 -20 68 -27 47 -12 107 -60 135 -109 18 -31 18 -31 -7 -41 -14 -5
-43 -20 -65 -34 -35 -22 -41 -23 -52 -10 -27 32 -68 44 -154 44 -48 0 -96 -5
-108 -12 -29 -16 -56 -15 -87 2 -36 21 -187 17 -229 -4 -18 -10 -35 -24 -38
-31 -4 -12 -13 -10 -47 11 -22 14 -53 30 -69 36 -15 5 -27 14 -27 20 0 21 112
126 153 143 23 9 65 28 93 42 81 38 103 43 204 39 78 -2 105 -7 150 -29z
m-567 -258 c67 -34 68 -35 50 -77 -20 -46 -22 -201 -4 -293 12 -62 11 -68 -13
-122 -14 -31 -29 -57 -34 -57 -13 0 -85 113 -118 185 -33 70 -41 138 -24 191
21 64 82 194 92 194 5 0 28 -10 51 -21z m905 -16 c11 -21 29 -69 42 -106 31
-95 25 -163 -22 -259 -44 -87 -95 -161 -110 -156 -5 2 -20 28 -33 58 -22 53
-22 58 -8 135 14 77 13 216 -2 276 -6 23 -1 28 52 57 32 17 59 32 60 32 2 0
11 -17 21 -37z"/>
<path d="M529 595 c-25 -56 -22 -76 14 -93 35 -17 154 -19 183 -4 38 20 45 36
33 73 -21 63 -33 69 -126 69 l-84 0 -20 -45z"/>
<path d="M399 487 c-17 -37 5 -101 50 -146 34 -34 40 -46 46 -102 8 -78 35
-142 67 -162 34 -22 88 -28 128 -14 29 10 39 21 57 67 13 33 23 77 23 110 0
50 3 57 31 75 47 31 81 95 77 147 -4 57 -29 59 -40 3 -11 -57 -27 -83 -64
-105 -40 -26 -46 -25 -83 6 -24 20 -31 34 -31 60 0 22 -6 37 -15 41 -21 8 -25
2 -29 -42 -2 -28 -10 -44 -32 -62 -36 -28 -48 -29 -85 -2 -36 25 -51 52 -58
103 -7 46 -26 57 -42 23z"/>
</g>
</svg>
                  </n-avatar>
                </template>
                <template #extra>
                  <n-flex justify="end">
                    <n-switch v-model:value="darkMode" :rail-style="darkModeRailStyle">
                      <template #checked> Dark </template>
                      <template #unchecked> Light </template>
                    </n-switch>
                  </n-flex>
                </template>
              </n-page-header>
              <n-tabs type="segment" animated>
                <n-tab-pane name="summary" tab="Summary">
                  <x-summary :res="res"></x-summary>
                </n-tab-pane>
                <n-tab-pane name="Requests" tab="Requests">
                  <x-requests :res="res"></x-requests>
                </n-tab-pane>
              </n-tabs>
            </n-flex>
          </n-card>
        </n-layout>
      </n-config-provider>
    </div>
    <script type="text/x-template" id="summary-component">
      <n-flex vertical>
        <n-flex justify="center">
          <n-alert type="success">
            <n-statistic
              label="Total Controls"
              :value="summaryTotalControls"
            >
            </n-statistic>
          </n-alert>
          <n-alert :type="summaryFailedControls ? 'error' : 'success'">
            <n-statistic
              label="Total Failed Controls"
              :value="summaryFailedControls"
            >
            </n-statistic>
          </n-alert>
          <n-alert :type="summaryErrors ? 'error' : 'success'">
            <n-statistic label="Total errors" :value="summaryErrors">
            </n-statistic>
          </n-alert>
        </n-flex>
        <n-card title="TIMINGS AND DATA">
          <n-flex justify="center">
            <n-statistic
              label="Total run duration"
              :value="Math.round(totalRunDuration*1000)/1000"
            >
              <template #suffix>s</template>
            </n-statistic>
            <n-statistic
              label="Total requests"
              :value="summaryTotalRequests"
            >
            </n-statistic>
          </n-flex>
        </n-card>
        <n-data-table :columns="summaryColumns" :data="summaryData" />
      </n-flex>
    </script>
    <script type="text/x-template" id="requests-component">
      <n-flex vertical>
        <n-switch
          v-model:value="onlyFailed"
          :rail-style="railStyle"
        >
          <template #checked> Only Failed </template>
          <template #unchecked> Only Failed </template>
        </n-switch>

        <n-collapse>
          <x-results-group v-for="(results, group) in groupedResults" :results="results" :group="group" :key="group + '-' + results.length"></x-results-group>
        </n-collapse>
      </n-flex>
    </script>
    <script type="text/x-template" id="results-group-component">
      <n-collapse-item
        :name="group"
        arrow-placement="right"
      >
        <template #header>
          <n-alert
            :type="hasError || hasFailure ? 'error' : 'success'"
            :bordered="false"
          >
            <template #header>
              {{group}} - {{totalPassed}} / {{total}} Passed {{ hasError? " - Error" : "" }}
            </template>
          </n-alert>
        </template>
        <n-collapse>
          <x-result v-for="(result, index) in results" :result="result" :group="group" :key="index"></x-result>
        </n-collapse>
      </n-collapse-item>
    </script>
    <script type="text/x-template" id="result-component">
      <n-collapse-item
        :name="name"
        arrow-placement="right"
      >
        <template #header>
          <n-alert
            :type="hasError || hasFailure ? 'error' : 'success'"
            :bordered="false"
          >
            <template #header>
              {{suitename}} - {{totalPassed}} / {{total}} Passed {{hasError ? " - Error" : "" }}
            </template>
          </n-alert>
        </template>
        <n-flex vertical>
          <n-grid x-gap="12" :cols="2">
            <n-gi>
              <n-card title="REQUEST INFORMATION">
                <n-list>
                  <n-list-item>
                    <n-thing
                      title="File"
                      :description="result.test.filename"
                    />
                  </n-list-item>
                  <n-list-item>
                    <n-thing
                      title="Request Method"
                      :description="result.request.method"
                    />
                  </n-list-item>
                  <n-list-item>
                    <n-thing
                      title="Request URL"
                      :description="result.request.url"
                    />
                  </n-list-item>
                </n-list>
              </n-card>
            </n-gi>
            <n-gi>
              <n-card title="RESPONSE INFORMATION">
                <n-list>
                  <n-list-item>
                    <n-thing
                      title="Response Code"
                      :description="'' + result.response.status"
                    />
                  </n-list-item>
                  <n-list-item>
                    <n-thing
                      title="Response time"
                      :description="result.response.responseTime + ' ms'"
                    />
                  </n-list-item>
                  <n-list-item>
                    <n-thing
                      title="Test duration"
                      :description="testDuration"
                    />
                  </n-list-item>
                </n-list>
              </n-card>
            </n-gi>
          </n-grid>
          <n-alert v-if="hasError" title="Error" type="error">
            {{result.error}}
          </n-alert>
          <n-card title="REQUEST HEADERS">
            <n-data-table
              :columns="headerColumns"
              :data="headerDataRequest"
            />
          </n-card>
          <n-card
            v-if="result.request.data"
            title="REQUEST BODY"
          >
            <pre>{{result.request.data}}</pre>
          </n-card>
          <n-card title="RESPONSE HEADERS">
            <n-data-table
              :columns="headerColumns"
              :data="headerDataResponse"
            />
          </n-card>
          <n-card
            v-if="result.response.data"
            title="RESPONSE BODY"
          >
            <pre>{{result.response.data}}</pre>
          </n-card>
          <n-card title="ASSERTIONS INFORMATION">
            <n-data-table
              :columns="assertionsColumns"
              :data="result.assertionResults"
              :row-class-name="assertionsRowClassName"
            />
          </n-card>
          <n-card title="TESTS INFORMATION">
            <n-data-table
              :columns="testsColumns"
              :data="result.testResults"
              :row-class-name="testsRowClassName"
            />
          </n-card>
        </n-flex>
      </n-collapse-item>
    </script>
    <script>
      const { createApp, ref, computed } = Vue;

      const App = {
        setup() {
          const res = {
            summary: {
              totalRequests: 10,
              passedRequests: 10,
              failedRequests: 0,
              totalAssertions: 4,
              passedAssertions: 0,
              failedAssertions: 4,
              totalTests: 0,
              passedTests: 0,
              failedTests: 0
            },
            results: [
              {
                test: {
                  filename: 'group1/test1.bru'
                },
                request: {
                  method: 'GET',
                  url: 'http://localhost:3000/test/v4',
                  headers: {
                    Accept: '*/*',
                    'Accept-Encoding': 'gzip, deflate, br'
                  }
                },
                response: {
                  status: 404,
                  statusText: 'Not Found',
                  headers: {
                    'x-powered-by': 'Express',
                    'content-security-policy': "default-src 'none'",
                    'x-content-type-options': 'nosniff',
                    'content-type': 'text/html; charset=utf-8',
                    'content-length': '146',
                    date: 'Fri, 29 Sep 2023 00:37:50 GMT',
                    connection: 'close'
                  },
                  responseTime: 96,
                  data: '<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="utf-8">\n<title>Error</title>\n</head>\n<body>\n<pre>Cannot GET /test/v4</pre>\n</body>\n</html>\n'
                },
                error: null,
                assertionResults: [
                  {
                    uid: 'oidgfXLiyD8Jv0NBAHUHF',
                    lhsExpr: 'res.status',
                    rhsExpr: '200',
                    rhsOperand: '200',
                    operator: 'eq',
                    status: 'fail',
                    error: 'expected 404 to equal 200'
                  }
                ],
                testResults: [
                  {
                    description: 'should be OK',
                    status: 'pass',
                    uid: 'P1nCbirrCv40DxI3bWvlR'
                  }
                ],
                suitename: 'group1/test1',
                runtime: 0.1
              },
              {
                test: {
                  filename: 'group1/test2.bru'
                },
                request: {
                  method: 'GET',
                  url: 'http://localhost:3000/test/v2',
                  headers: {
                    Accept: '*/*',
                    'Accept-Encoding': 'gzip, deflate, br'
                  }
                },
                response: {
                  status: 404,
                  statusText: 'Not Found',
                  headers: {
                    'x-powered-by': 'Express',
                    'content-security-policy': "default-src 'none'",
                    'x-content-type-options': 'nosniff',
                    'content-type': 'text/html; charset=utf-8',
                    'content-length': '146',
                    date: 'Fri, 29 Sep 2023 00:37:50 GMT',
                    connection: 'close'
                  },
                  responseTime: 96,
                  data: '<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="utf-8">\n<title>Error</title>\n</head>\n<body>\n<pre>Cannot GET /test/v2</pre>\n</body>\n</html>\n'
                },
                error: null,
                assertionResults: [
                  {
                    uid: 'IgliYuHd9wKp6JNyqyHFK',
                    lhsExpr: 'res.status',
                    rhsExpr: '200',
                    rhsOperand: '200',
                    operator: 'eq',
                    status: 'fail',
                    error: 'expected 404 to equal 200'
                  }
                ],
                testResults: [],
                suitename: 'group1/test2',
                runtime: 0.1
              },
              {
                test: {
                  filename: 'group1/test3.bru'
                },
                request: {
                  method: 'GET',
                  url: 'http://localhost:3000/test/v3',
                  headers: {
                    Accept: '*/*',
                    'Accept-Encoding': 'gzip, deflate, br'
                  }
                },
                response: {
                  status: 404,
                  statusText: 'Not Found',
                  headers: {
                    'x-powered-by': 'Express',
                    'content-security-policy': "default-src 'none'",
                    'x-content-type-options': 'nosniff',
                    'content-type': 'text/html; charset=utf-8',
                    'content-length': '146',
                    date: 'Fri, 29 Sep 2023 00:37:50 GMT',
                    connection: 'close'
                  },
                  responseTime: 96,
                  data: '<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="utf-8">\n<title>Error</title>\n</head>\n<body>\n<pre>Cannot GET /test/v3</pre>\n</body>\n</html>\n'
                },
                error: null,
                assertionResults: [
                  {
                    uid: 'u-3sRebrCyuUbZOkwS0z8',
                    lhsExpr: 'res.status',
                    rhsExpr: '200',
                    rhsOperand: '200',
                    operator: 'eq',
                    status: 'fail',
                    error: 'expected 404 to equal 200'
                  }
                ],
                testResults: [],
                suitename: 'group1/test3',
                runtime: 0.1
              },
              {
                test: {
                  filename: 'group2/test1.bru'
                },
                request: {
                  method: 'POST',
                  url: 'http://localhost:3000/test/v1',
                  headers: {
                    'content-type': 'application/json'
                  },
                  data: {
                    test: 'hello'
                  }
                },
                response: {
                  status: 404,
                  statusText: 'Not Found',
                  headers: {
                    'x-powered-by': 'Express',
                    'content-security-policy': "default-src 'none'",
                    'x-content-type-options': 'nosniff',
                    'content-type': 'text/html; charset=utf-8',
                    'content-length': '147',
                    date: 'Fri, 29 Sep 2023 00:37:50 GMT',
                    connection: 'close'
                  },
                  responseTime: 96,
                  data: '<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="utf-8">\n<title>Error</title>\n</head>\n<body>\n<pre>Cannot POST /test/v1</pre>\n</body>\n</html>\n'
                },
                error: null,
                assertionResults: [],
                testResults: [
                  {
                    description: 'should fail',
                    status: 'fail',
                    error: 'expected 404 to deeply equal 200',
                    actual: 404,
                    expected: 200,
                    uid: 'PpKLK6I38I5_ibw4lZqLb'
                  },
                  {
                    description: 'should be OK',
                    status: 'pass',
                    uid: 'P1nCbirrCv40DxI3bWvlR'
                  }
                ],
                suitename: 'group2/test1',
                runtime: 0.1
              },
              {
                test: {
                  filename: 'group2/test2.bru'
                },
                request: {
                  method: 'POST',
                  url: 'http://localhost:3000/test',
                  headers: {
                    Accept: '*/*',
                    'Accept-Encoding': 'gzip, deflate, br'
                  }
                },
                response: {
                  status: 404,
                  statusText: 'Not Found',
                  headers: {
                    'x-powered-by': 'Express',
                    'content-security-policy': "default-src 'none'",
                    'x-content-type-options': 'nosniff',
                    'content-type': 'text/html; charset=utf-8',
                    'content-length': '144',
                    date: 'Fri, 29 Sep 2023 00:37:50 GMT',
                    connection: 'close'
                  },
                  responseTime: 96,
                  data: '<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="utf-8">\n<title>Error</title>\n</head>\n<body>\n<pre>Cannot POST /test</pre>\n</body>\n</html>\n'
                },
                error: null,
                assertionResults: [],
                testResults: [],
                suitename: 'group2/test2',
                runtime: 0.1
              },
              {
                test: {
                  filename: 'test1.bru'
                },
                request: {
                  method: 'HEAD',
                  url: 'http://localhost:3000/',
                  headers: {
                    Accept: '*/*',
                    'Accept-Encoding': 'gzip, deflate, br'
                  }
                },
                response: {
                  status: 200,
                  statusText: 'OK',
                  headers: {
                    'x-powered-by': 'Express',
                    'content-type': 'text/html; charset=utf-8',
                    'content-length': '12',
                    etag: 'W/"c-Lve95gjOVATpfV8EL5X4nxwjKHE"',
                    date: 'Fri, 29 Sep 2023 00:37:50 GMT',
                    connection: 'close'
                  },
                  responseTime: 96,
                  data: ''
                },
                error: null,
                assertionResults: [],
                testResults: [],
                suitename: 'test1',
                runtime: 0.1
              },
              {
                test: {
                  filename: 'test2.bru'
                },
                request: {
                  method: 'POST',
                  url: 'http://localhost:3000',
                  headers: {
                    Accept: '*/*',
                    'Accept-Encoding': 'gzip, deflate, br'
                  }
                },
                response: {
                  status: 404,
                  statusText: 'Not Found',
                  headers: {
                    'x-powered-by': 'Express',
                    'content-security-policy': "default-src 'none'",
                    'x-content-type-options': 'nosniff',
                    'content-type': 'text/html; charset=utf-8',
                    'content-length': '140',
                    date: 'Fri, 29 Sep 2023 00:37:50 GMT',
                    connection: 'close'
                  },
                  responseTime: 96,
                  data: '<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="utf-8">\n<title>Error</title>\n</head>\n<body>\n<pre>Cannot POST /</pre>\n</body>\n</html>\n'
                },
                error: null,
                assertionResults: [],
                testResults: [],
                suitename: 'test2',
                runtime: 0.1
              },
              {
                test: {
                  filename: 'test3.bru'
                },
                request: {
                  method: 'POST',
                  url: 'http://localhost:3000/',
                  headers: {
                    'content-type': 'multipart/form-data; boundary=--------------------------897965859410704836065858'
                  },
                  data: {
                    _overheadLength: 103,
                    _valueLength: 3,
                    _valuesToMeasure: [],
                    writable: false,
                    readable: true,
                    dataSize: 0,
                    maxDataSize: 2097152,
                    pauseStreams: true,
                    _released: true,
                    _streams: [],
                    _currentStream: null,
                    _insideLoop: false,
                    _pendingNext: false,
                    _boundary: '--------------------------897965859410704836065858',
                    _events: {},
                    _eventsCount: 3
                  }
                },
                response: {
                  status: 404,
                  statusText: 'Not Found',
                  headers: {
                    'x-powered-by': 'Express',
                    'content-security-policy': "default-src 'none'",
                    'x-content-type-options': 'nosniff',
                    'content-type': 'text/html; charset=utf-8',
                    'content-length': '140',
                    date: 'Fri, 29 Sep 2023 00:37:50 GMT',
                    connection: 'close'
                  },
                  responseTime: 96,
                  data: '<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="utf-8">\n<title>Error</title>\n</head>\n<body>\n<pre>Cannot POST /</pre>\n</body>\n</html>\n'
                },
                error: "Cannot find module 'ajv-formats'",
                assertionResults: [],
                testResults: [],
                suitename: 'test3',
                runtime: 0.1
              },
              {
                test: {
                  filename: 'test4.bru'
                },
                request: {
                  method: 'POST',
                  url: 'http://localhost:3000/',
                  headers: {
                    'content-type': 'application/x-www-form-urlencoded'
                  },
                  data: 'a=b&c=d'
                },
                response: {
                  status: 404,
                  statusText: 'Not Found',
                  headers: {
                    'x-powered-by': 'Express',
                    'content-security-policy': "default-src 'none'",
                    'x-content-type-options': 'nosniff',
                    'content-type': 'text/html; charset=utf-8',
                    'content-length': '140',
                    date: 'Fri, 29 Sep 2023 00:37:50 GMT',
                    connection: 'close'
                  },
                  responseTime: 96,
                  data: '<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="utf-8">\n<title>Error</title>\n</head>\n<body>\n<pre>Cannot POST /</pre>\n</body>\n</html>\n'
                },
                error: null,
                assertionResults: [],
                testResults: [],
                suitename: 'test4',
                runtime: 0.1
              },
              {
                test: {
                  filename: 'test5.bru'
                },
                request: {
                  method: 'POST',
                  url: 'http://localhost:3000/test',
                  headers: {
                    'content-type': 'text/xml'
                  },
                  data: '<xml>\n  <test>1</test>\n</xml>'
                },
                response: {
                  status: 404,
                  statusText: 'Not Found',
                  headers: {
                    'x-powered-by': 'Express',
                    'content-security-policy': "default-src 'none'",
                    'x-content-type-options': 'nosniff',
                    'content-type': 'text/html; charset=utf-8',
                    'content-length': '144',
                    date: 'Fri, 29 Sep 2023 00:37:50 GMT',
                    connection: 'close'
                  },
                  responseTime: 96,
                  data: '<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="utf-8">\n<title>Error</title>\n</head>\n<body>\n<pre>Cannot POST /test</pre>\n</body>\n</html>\n'
                },
                error: null,
                assertionResults: [],
                testResults: [],
                suitename: 'test5',
                runtime: 0.1
              }
            ]
          };

          const darkMode = ref(false);
          const theme = computed(() => {
            return darkMode.value ? naive.darkTheme : null;
          });
          if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            darkMode.value = true;
          }
          // To watch for os theme changes
          window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (event) => {
            darkMode.value = event.matches;
          });
          return {
            res,
            theme,
            darkMode,
            darkModeRailStyle: () => ({ background: 'var(--n-rail-color)' })
          };
        }
      };
      const app = Vue.createApp(App);

      app.component('x-summary', {
        template: `#summary-component`,
        props: ['res'],
        setup(props) {
          const summaryColumns = [
            {
              title: 'SUMMARY ITEM',
              key: 'title'
            },
            {
              title: 'TOTAL',
              key: 'total'
            },
            {
              title: 'PASSED',
              key: 'passed'
            },
            {
              title: 'FAILED',
              key: 'failed'
            }
          ];
          const summaryData = computed(() => [
            {
              title: 'Requests',
              total: props.res.summary.totalRequests,
              passed: props.res.summary.passedRequests,
              failed: props.res.summary.failedRequests
            },
            {
              title: 'Assertions',
              total: props.res.summary.totalAssertions,
              passed: props.res.summary.passedAssertions,
              failed: props.res.summary.failedAssertions
            },
            {
              title: 'Tests',
              total: props.res.summary.totalTests,
              passed: props.res.summary.passedTests,
              failed: props.res.summary.failedTests
            }
          ]);
          const summaryTotalRequests = computed(() => {
            return props.res.summary.totalRequests;
          });
          const summaryTotalControls = computed(() => {
            return props.res.summary.totalTests + props.res.summary.totalAssertions;
          });
          const summaryFailedControls = computed(
            () => props.res.summary.failedRequests + props.res.summary.failedTests + props.res.summary.failedAssertions
          );
          const summaryErrors = computed(() => props.res.results.filter((r) => r.error).length);
          const totalRunDuration = computed(() => props.res?.results?.reduce((total, test) => test.runtime + total, 0));
          return {
            summaryColumns,
            summaryData,
            summaryTotalControls,
            summaryTotalRequests,
            summaryFailedControls,
            summaryErrors,
            totalRunDuration
          };
        }
      });

      app.component('x-requests', {
        template: `#requests-component`,
        props: ['res'],
        setup(props) {
          const onlyFailed = ref(false);
          const filteredResults = computed(() => {
            if (onlyFailed.value) {
              return props.res.results.filter(
                (r) =>
                  !!r.error ||
                  !!r.testResults.find((t) => t.status !== 'pass') ||
                  !!r.assertionResults.find((t) => t.status !== 'pass')
              );
            }
            return props.res.results;
          });
          const groupedResults = computed(() => {
            return filteredResults.value.reduce((groups, curr) => {
              const path = curr.suitename.split('/');
              const test = path.pop();
              const name = path.length ? path.join('/') : '(root)';
              if (!groups[name]) {
                groups[name] = [];
              }
              groups[name].push(curr);
              return groups;
            }, {});
          });
          return {
            onlyFailed,
            groupedResults,
            railStyle: ({ checked }) => {
              const style = {};
              if (checked) {
                style.background = '#d03050';
              }
              return style;
            }
          };
        }
      });

      app.component('x-results-group', {
        template: `#results-group-component`,
        props: ['group', 'results'],
        setup(props) {
          const totalPassed = computed(() => {
            return props.results.reduce((total, curr) => {
              return (
                total +
                curr.testResults.filter((t) => t.status === 'pass').length +
                curr.assertionResults.filter((t) => t.status === 'pass').length
              );
            }, 0);
          });
          const total = computed(() => {
            return props.results.reduce((total, curr) => {
              return total + curr.testResults.length + curr.assertionResults.length;
            }, 0);
          });

          const hasError = computed(() => props.results.some((r) => !!r.error));
          const hasFailure = computed(() => totalPassed.value !== total.value);
          return {
            totalPassed,
            total,
            hasFailure,
            hasError,
            group: props.group,
            results: props.results
          };
        }
      });

      app.component('x-result', {
        template: `#result-component`,
        props: ['group', 'result'],
        setup(props) {
          const headerColumns = [
            {
              title: 'Header Name',
              key: 'name',
              className: 'min-width-150'
            },
            {
              title: 'Header Value',
              key: 'value'
            }
          ];
          const assertionsColumns = [
            {
              title: 'Expression',
              key: 'lhsExpr'
            },
            {
              title: 'Operator',
              key: 'operator'
            },
            {
              title: 'Operand',
              key: 'rhsOperand'
            },
            {
              title: 'Status',
              key: 'status',
              className: 'status'
            },
            {
              title: 'Error',
              key: 'error'
            }
          ];
          const assertionsRowClassName = (row) => {
            return row.status === 'fail' ? 'error' : 'success';
          };
          const testsRowClassName = (row) => {
            return row.status === 'fail' ? 'error' : 'success';
          };
          const testsColumns = [
            {
              title: 'Description',
              key: 'description'
            },
            {
              title: 'Status',
              key: 'status',
              className: 'status'
            },
            {
              title: 'Error',
              key: 'error'
            }
          ];

          function mapHeaderToTableData(headers) {
            if (!headers) {
              return [];
            }
            return Object.keys(headers).map((name) => ({
              name,
              value: headers[name]
            }));
          }
          const headerDataRequest = computed(() => {
            return mapHeaderToTableData(props.result.request.headers);
          });
          const headerDataResponse = computed(() => {
            return mapHeaderToTableData(props.result.response.headers);
          });
          const totalPassed = computed(() => {
            return (
              props.result.testResults.filter((t) => t.status === 'pass').length +
              props.result.assertionResults.filter((t) => t.status === 'pass').length
            );
          });
          const total = computed(() => {
            return props.result.testResults.length + props.result.assertionResults.length;
          });

          const hasError = computed(() => !!props.result.error);
          const hasFailure = computed(() => total.value !== totalPassed.value);
          const suitename = computed(() => props.result.suitename.replace(props.group + '/', ''));
          const testDuration = computed(() => Math.round(props.result.runtime * 1000) + ' ms');
          const name = computed(() => props.result.suitename + props.result.runtime);
          return {
            headerColumns,
            headerDataRequest,
            headerDataResponse,
            assertionsColumns,
            assertionsRowClassName,
            testsRowClassName,
            totalPassed,
            total,
            hasFailure,
            hasError,
            testsColumns,
            result: props.result,
            suitename,
            testDuration,
            name
          };
        }
      });
      app.use(naive);
      app.mount('#app');
    </script>
  </body>
</html>
